---
apiVersion: v1
kind: Pod
metadata:
  name: ndn-service-pod2
  labels:
    name: ndn-service-pod2
spec:
  containers:
    - name: service
      image: relay-service:x86
      imagePullPolicy: Never  # ← Minikube内のローカルイメージを使うために重要！
      tty: true
      volumeMounts:
        - mountPath: /share
          name: share-volume
      env:
        - name: MY_POD_IP
          valueFrom:
            fieldRef:
              fieldPath: status.podIP
        - name: TCP_MESSAGE_PORT
          value: "1234"
        - name: SHARE_PATH
          value: /share/
    - name: sidecar
      image: ndn-sidecar:x86
      imagePullPolicy: Never  # ← Minikube内のローカルイメージを使うために重要！
      tty: true
      ports:
        - containerPort: 6363
      securityContext:
        privileged: true
      volumeMounts:
        - mountPath: /share
          name: share-volume
        - mountPath: /var/log/sidecar
          name: sidecar-logs
      env:
        - name: MY_POD_IP
          valueFrom:
            fieldRef:
              fieldPath: status.podIP
        - name: MY_HOST_IP
          valueFrom:
            fieldRef:
              fieldPath: status.hostIP
        - name: TCP_MESSAGE_PORT
          value: "1234"
        - name: SHARE_PATH
          value: /share/
        - name: NDN_CLIENT_TRANSPORT
          value: tcp4://ndn-node2
        - name: ROUTER_PREFIX
          value: /ndn/jp/%C1.Router/node2
        - name: MY_SERVICE_NAME
          value: /relay
  volumes:
    - name: share-volume
      emptyDir: {}
    - name: sidecar-logs
      hostPath:
        path: /mnt/sidecar-logs-node2
        type: DirectoryOrCreate

